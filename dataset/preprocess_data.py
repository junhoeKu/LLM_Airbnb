# -*- coding: utf-8 -*-
"""preprocess_data(ì „ì²˜ë¦¬ì¶”ê°€)

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/19NV8COYjkhjBmuNZdhXjE2uaJg3lEvpb
"""


import pandas as pd
import numpy as np
import re
import matplotlib.pyplot as plt
import seaborn as sns

## Dataset Load
overview1 = pd.read_csv('/content/drive/MyDrive/dataset/AirbnbOverview.csv')
overview2 = pd.read_csv('/content/drive/MyDrive/dataset/AirbnbOverview2.csv')
amenity = pd.read_csv('/content/drive/MyDrive/dataset/Amenities_20012025.csv')
calendar1 = pd.read_csv('/content/drive/MyDrive/dataset/Calendar_11122024.csv')
calendar2 = pd.read_csv('/content/drive/MyDrive/dataset/Calendar_18012025.csv')
description = pd.read_csv('/content/drive/MyDrive/dataset/Description_20012025.csv')
pricing1 = pd.read_csv('/content/drive/MyDrive/dataset/Pricing_11122024.csv')
pricing2 = pd.read_csv('/content/drive/MyDrive/dataset/Pricing_20012025.csv')
review = pd.read_csv('/content/drive/MyDrive/dataset/Reviews_20012025.csv')
data = pd.read_excel('/content/drive/MyDrive/dataset/DataDictionary.xlsx')

review.head()

## Dataset Concat
# 1ì€ 2024ë…„ 12ì›” 11ì¼ê¹Œì§€ì˜ ë°ì´í„° 2ëŠ” 2025ë…„ 1ì›” 20ì¼ê¹Œì§€ì˜ ë°ì´í„° ì´ 2ê°œë¥¼ í•©ì¹˜ëŠ” ê³³ë³´ë‹¤ ë°ì´í„° 2ì— ë°ì´í„° 1ì„ í•©ì¹˜ëŠ” ë°©í–¥ì´ ë‚˜ì„ë“¯
## overview
# ë¨¼ì € ë‘ ê°œì˜ ë°ì´í„°ë¥¼ concatìœ¼ë¡œ í•©ì³ì„œ ì „ì²´ listing ID ë¹ˆë„ í™•ì¸
overview_all = pd.concat([overview1, overview2])
listing_counts = overview_all['Airbnb_ListingID'].value_counts()
# IDë³„ë¡œ ëª‡ ë²ˆ ë‚˜ì˜¤ëŠ”ì§€ íŒë‹¨í•´ì„œ ì¡°ê±´ ë¶„ê¸°
ids_appeared_twice = listing_counts[listing_counts == 2].index
ids_appeared_once = listing_counts[listing_counts == 1].index
# ì¡°ê±´ì— ë§ê²Œ ë°ì´í„° ì„ íƒ
overview = pd.concat([
    overview2[overview2['Airbnb_ListingID'].isin(ids_appeared_twice)],
    overview1[overview1['Airbnb_ListingID'].isin(ids_appeared_once)]
], ignore_index=True)

## calendar
# ë‚ ì§œ ê¸°ì¤€ ì„¤ì •
cutoff_date = pd.to_datetime("2025-01-18")
# datetime íƒ€ì…ìœ¼ë¡œ ë³€í™˜ (í˜¹ì‹œ ë¬¸ìì—´ì¼ ê²½ìš° ëŒ€ë¹„)
calendar1['Calendar_Date'] = pd.to_datetime(calendar1['Calendar_Date'])
calendar2['Calendar_Date'] = pd.to_datetime(calendar2['Calendar_Date'])
# ì¡°ê±´ì— ë§ê²Œ í•„í„°ë§
calendar1_filtered = calendar1[calendar1['Calendar_Date'] <= cutoff_date]
calendar2_filtered = calendar2[calendar2['Calendar_Date'] > cutoff_date]
# ë³‘í•©
calendar = pd.concat([calendar1_filtered, calendar2_filtered], ignore_index=True)

## pricing
# ê¸°ì¤€ ë‚ ì§œ ì„¤ì •
cutoff_date = pd.to_datetime("2025-01-20")

# datetime ë³€í™˜ (ë¬¸ìì—´ì¼ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì•ˆì „í•˜ê²Œ ë³€í™˜)
pricing1['Stay_Checkout'] = pd.to_datetime(pricing1['Stay_Checkout'])
pricing2['Stay_Checkout'] = pd.to_datetime(pricing2['Stay_Checkout'])

# ì¡°ê±´ì— ë§ê²Œ í•„í„°ë§
pricing1_filtered = pricing1[pricing1['Stay_Checkout'] < cutoff_date]
pricing2_filtered = pricing2[pricing2['Stay_Checkout'] >= cutoff_date]

# ë³‘í•©
pricing = pd.concat([pricing1_filtered, pricing2_filtered], ignore_index=True)

## overview & description

overview = overview.dropna(subset=['Airbnb_ListingID'])
description = description.dropna(subset=['Airbnb_ListingID'])
overview = overview.dropna(subset=['Host_ID'])
description = description.dropna(subset=['Host_ID'])



# Airbnb_ListingIDì™€ Host_ID ëª¨ë‘ ë¬¸ìì—´ë¡œ í†µì¼
description['Airbnb_ListingID'] = pd.to_numeric(description['Airbnb_ListingID'], errors='coerce')
overview['Airbnb_ListingID'] = pd.to_numeric(overview['Airbnb_ListingID'], errors='coerce')

description['Host_ID'] = pd.to_numeric(description['Host_ID'], errors='coerce')
overview['Host_ID'] = pd.to_numeric(overview['Host_ID'], errors='coerce')
overview['Host_ID'] = overview['Host_ID'].astype(float)

des_over = overview.merge(
    description,
    on=['Airbnb_ListingID'],
    how='inner',
    suffixes=('_review', '_desc')
)

print(des_over.isnull().sum().to_string())

des_over['Lat']

## calendar & pricing

# 1. ë‚ ì§œ íƒ€ì… ë§ì¶”ê¸°
calendar['Calendar_Date'] = pd.to_datetime(calendar['Calendar_Date'])
pricing['Stay_Checkin'] = pd.to_datetime(pricing['Stay_Checkin'])
pricing['Stay_Checkout'] = pd.to_datetime(pricing['Stay_Checkout'])

# 2. pricing í™•ì¥: ì²´í¬ì¸~ì²´í¬ì•„ì›ƒ ë‚ ì§œ ë³„ë¡œ í’€ê¸° (ì²´í¬ì•„ì›ƒ ì „ë‚ ê¹Œì§€)
pricing_expanded = []
for _, row in pricing.iterrows():
    stay_dates = pd.date_range(
        start=row['Stay_Checkin'],
        end=row['Stay_Checkout'] - pd.Timedelta(days=1),
        freq='D'
    )
    for date in stay_dates:
        pricing_expanded.append({
            'Airbnb_ListingID': row['Airbnb_ListingID'],
            'Calendar_Date': date.normalize(),  # ë‚ ì§œ ë‹¨ìœ„ë§Œ ì‚¬ìš©
            'Guests': row['Guests'],  # ğŸ‘ˆ Guests ì¸ì› ì¶”ê°€
            'Price_Per_Night': row['Price_Per_Night'],
            'Cleaning_Fee': row['Cleaning_Fee'],
            'Airbnb_Service_Fee': row['Airbnb_Service_Fee'],
            'Taxes': row['Taxes']
        })

pricing_expanded_df = pd.DataFrame(pricing_expanded)

# 3. calendarì™€ ë³‘í•© (ë‚ ì§œ ë‹¨ìœ„ ì •í™•íˆ ë§¤ì¹­)
calendar['Calendar_Date'] = calendar['Calendar_Date'].dt.normalize()
cal_pri = calendar.merge(
    pricing_expanded_df,
    on=['Airbnb_ListingID', 'Calendar_Date'],
    how='left'
)

# 4. Price_Per_Nightê°€ NaNì¸ í–‰ ì œê±°
cal_pri = cal_pri[cal_pri['Price_Per_Night'].notna()].reset_index(drop=True)

# Step 1: Airbnb_ListingIDë³„ Cleaning_Fee í‰ê· ê°’ ê³„ì‚° (NaN ì œì™¸)
cleaning_fee_map = cal_pri.groupby('Airbnb_ListingID')['Cleaning_Fee'].transform(
    lambda x: x.fillna(method='ffill').fillna(method='bfill')
)

# Step 2: í•´ë‹¹ ê°’ì„ ìš°ì„  ì±„ìš°ê³ , ì—¬ì „íˆ NaNì´ë©´ 0ìœ¼ë¡œ ëŒ€ì²´
cal_pri['Cleaning_Fee'] = cal_pri['Cleaning_Fee'].fillna(cleaning_fee_map)
cal_pri['Cleaning_Fee'] = cal_pri['Cleaning_Fee'].fillna(0)

pricing_expanded_df

print(cal_pri.isnull().sum().to_string())

cal_pri.head()

## review ì „ì²˜ë¦¬
review = review.dropna(subset=['Airbnb_ListingID'])
review['Airbnb_ListingID'] = pd.to_numeric(review['Airbnb_ListingID'], errors='coerce')
review['Rating'] = pd.to_numeric(review['Rating'], errors='coerce')
review = review.dropna(subset=['Rating'])
review['Rating'] = review['Rating'].astype(int)

columns_for_rag_summary = [
    # ìœ„ì¹˜ ë° ê¸°ë³¸ ì •ë³´
    'Airbnb_ListingID', 'Location', 'City', 'LocalizedNeighborhood','Lat','Lng'
    # ê³µê°„ êµ¬ì„±
    'Bedrooms', 'Beds', 'Bathrooms', 'PersonCapacity',

    # ê°€ê²©
    'Price_Per_Night', 'Cleaning_Fee', 'Taxes','total_price'

    # ìˆ™ì†Œ/ê³µê°„ íƒ€ì…
    'RoomType_Clean', 'SpaceType_Clean',

    # í˜¸ìŠ¤íŠ¸ ê´€ë ¨
    'Host_isSuperhost', 'Host_ResponseRate', 'Host_ResponseTime','HostLanguages_Verbose'

    # í¸ì˜ì‹œì„¤
    'amenities_SelfCheckIn','CheckIn_Start','CheckOut_End'

    # ê°ì„±/ë¶„ìœ„ê¸° ê´€ë ¨ í…ìŠ¤íŠ¸
    'ListingTitle_Localized', 'MainDescription_Localized', 'SpaceDescription_Localized',
    'PhotoCaptions_Localized', 'Host_Highlights', 'HostAbout_Localized',

    # ë¦¬ë·°
    'ReviewScore', 'StarRating', 'ReviewCount', 'ReviewComments_Localized',

    # ê¸°íƒ€
    'PictureCount'
]

"""# 1. ìˆ™ì†Œ ì œëª© ì •ë¦¬"""

des_over.head()

title_df= des_over[['Airbnb_ListingID','Title']]
title_df['Title'] = title_df['Title'].fillna("")
title_df

"""# 2. ìˆ™ì†Œ ìœ„ì¹˜ ì •ë¦¬"""

location_df = des_over[['Airbnb_ListingID', 'Location','Lat','Lng','LocalizedNeighbourhood_ML','LocationDescription']]
location_df['LocationDescription'] = location_df['LocationDescription'].fillna("")

"""# 3. ìˆ™ì†Œ ì •ë³´ ì •ë¦¬"""

infor_df=des_over[['Airbnb_ListingID','MainDescription','SpaceDescription','GuestAccessDescription']]
infor_df['MainDescription'] = infor_df['MainDescription'].fillna("")
infor_df['SpaceDescription'] = infor_df['SpaceDescription'].fillna("")
infor_df['GuestAccessDescription'] = infor_df['GuestAccessDescription'].fillna("")
infor_df

"""# 4. ìˆ™ì†Œ êµ¬ì„± ì •ë¦¬"""

from tqdm import tqdm

tqdm.pandas()
amenity_df = amenity.copy()

## ì–´ë©”ë‹ˆí‹° ì»¬ëŸ¼ë“¤ë§Œ ì„ íƒ (Airbnb_ListingID ë° ê¸°ë³¸ ì»¬ëŸ¼ ì œì™¸)
amenity_cols = amenity_df.columns.difference(['Location', 'Country', 'Airbnb_ListingID', 'RecordInserted'])

## ì–´ë©”ë‹ˆí‹°ê°€ ìˆëŠ” ê²½ìš°ë¥¼ Trueë¡œ ë°”ê¾¸ê¸°
amenity_binary = amenity_df[amenity_cols].fillna(0).astype(int)

## Trueì¸ ì»¬ëŸ¼ ì´ë¦„ë§Œ ë¦¬ìŠ¤íŠ¸ë¡œ ì¶”ì¶œ
def get_amenities(row):
    return ', '.join([col for col in amenity_binary.columns if row[col] == 1])

amenity_df['Amenities'] = amenity_binary.progress_apply(get_amenities, axis=1)
amenity_df = amenity_df[['Airbnb_ListingID', 'Amenities']]

## amenity_df merge
amenity_df = amenity_df[['Airbnb_ListingID', 'Amenities']]
amenity_df = des_over[['Airbnb_ListingID', 'Bathrooms', 'Bedrooms', 'Beds', 'PersonCapacity']].merge(amenity_df, on = 'Airbnb_ListingID', how = 'inner')

## ê²¹ì¹˜ëŠ” ìˆ™ì†Œ ID ì œê±°
amenity_df = amenity_df.drop_duplicates(subset='Airbnb_ListingID', keep='first')
amenity_df = amenity_df.fillna(0)
amenity_df

"""# 5. ìˆ™ì†Œ ê°€ê²© ì •ë¦¬

"""

# Calendar_Dateë¥¼ ê¸°ì¤€ìœ¼ë¡œ í•´ì•¼ ì˜ˆì•½ì—¬ë¶€ë‘ ê°€ê²©ì„ ì •ë¦¬ í•  ìˆ˜ ìˆì„ë“¯
cal_pri.head()

# ì‚­ì œí•  ì»¬ëŸ¼ ë¦¬ìŠ¤íŠ¸
cols_to_drop = ['Country', 'Location', 'Calendar_Month', 'Calendar_Year', 'Stay_Week', 'RecordInserted', 'Taxes']

# ì‹¤ì œ ì¡´ì¬í•˜ëŠ” ì»¬ëŸ¼ë§Œ ë‚¨ê¸°ê³  ë“œë¡­
cal_pri.drop(columns=[col for col in cols_to_drop if col in cal_pri.columns], inplace=True)

Airbnb_Servic_map = cal_pri.groupby('Airbnb_ListingID')['Airbnb_Service_Fee'].transform(
    lambda x: x.fillna(method='ffill').fillna(method='bfill')
)

# Step 2: í•´ë‹¹ ê°’ì„ ìš°ì„  ì±„ìš°ê³ , ì—¬ì „íˆ NaNì´ë©´ 0ìœ¼ë¡œ ëŒ€ì²´
cal_pri['Airbnb_Service_Fee'] = cal_pri['Airbnb_Service_Fee'].fillna(Airbnb_Servic_map)
cal_pri['Airbnb_Service_Fee'] = cal_pri['Airbnb_Service_Fee'].fillna(0)

# ìš°ì„  Calendar_Dateë¥¼ datetime íƒ€ì…ìœ¼ë¡œ ë³€í™˜
cal_pri['Calendar_Date'] = pd.to_datetime(cal_pri['Calendar_Date'])

def compress_by_month(sub_df):
    """Airbnb_ListingIDë³„, ì›”ë³„ ì˜ˆì•½ ê°€ëŠ¥ì¼ ìš”ì•½"""
    available_dates = sub_df[sub_df['isAvailable']]['Calendar_Date'].sort_values()

    if available_dates.empty:
        return ""

    available_dates = available_dates.dt.to_period('D')  # ë‚ ì§œë§Œ ë‚¨ê¸°ê¸°
    month_groups = {}

    for date in available_dates:
        month = date.strftime('%mì›”')
        day = int(date.strftime('%d'))
        month_groups.setdefault(month, []).append(day)

    # ìš”ì•½ í¬ë§·
    summary = []
    for month, days in month_groups.items():
        days.sort()
        compressed = []
        start = prev = days[0]
        for d in days[1:]:
            if d == prev + 1:
                prev = d
            else:
                compressed.append(f"{start}-{prev}" if start != prev else f"{start}")
                start = prev = d
        compressed.append(f"{start}-{prev}" if start != prev else f"{start}")
        summary.append(f"{month}: {', '.join(map(str, compressed))}")

    return "; ".join(summary)


# Airbnb_ListingID ë³„ë¡œ ê·¸ë£¹í™” í›„, Available_Ranges ì»¬ëŸ¼ ìƒì„±
available_ranges_df = cal_pri.groupby('Airbnb_ListingID').apply(compress_by_month).reset_index()
available_ranges_df.columns = ['Airbnb_ListingID', 'Available_Ranges']

# ì›ë³¸ cal_priì— merge
cal_pri = cal_pri.merge(available_ranges_df, on='Airbnb_ListingID', how='left')

cal_pri

# ê°€ê²© ì»¬ëŸ¼ë“¤ì„ ìˆ«ìí˜•ìœ¼ë¡œ ë³€í™˜
price = ['Price_Per_Night', 'Cleaning_Fee', 'Airbnb_Service_Fee']
for col in price:
    cal_pri[col] = pd.to_numeric(cal_pri[col].astype(str).str.replace(r'[^\d.]', '', regex=True), errors='coerce')

# ìˆ™ì†Œë³„ í‰ê·  ê°€ê²© ê³„ì‚°
cal_pri_additional = cal_pri.groupby('Airbnb_ListingID').agg({
    'Price_Per_Night': 'mean',
    'Cleaning_Fee': 'mean',
    'Airbnb_Service_Fee': 'mean'
}).reset_index()

# ì»¬ëŸ¼ëª… ë³€ê²½ (optional)
cal_pri_additional.rename(columns={
    'Price_Per_Night': 'Price_Per_Night_mean',
    'Cleaning_Fee': 'Cleaning_Fee_mean',
    'Airbnb_Service_Fee': 'Airbnb_Service_Fee_mean'
}, inplace=True)

# ì›ë³¸ cal_priì— merge
cal_pri = cal_pri.merge(cal_pri_additional, on='Airbnb_ListingID', how='left')

cal_pri

cal_pri['total_price'] = cal_pri['Price_Per_Night'] + cal_pri['Cleaning_Fee'] + cal_pri['Airbnb_Service_Fee']

cal_pri['total_price_mean'] = cal_pri['Price_Per_Night_mean'] + cal_pri['Cleaning_Fee_mean'] + cal_pri['Airbnb_Service_Fee_mean']

cal_pri.head()

"""# 6. ìˆ™ì†Œ ìœ í˜• ì •ë¦¬"""

## ê²¹ì¹˜ëŠ” ìˆ™ì†Œ ID ì œê±°
type_df = des_over[['Airbnb_ListingID', 'RoomType_Clean', 'SpaceType_Clean']]
type_df

"""# 7. ìŠˆí¼í˜¸ìŠ¤íŠ¸ ì—¬ë¶€"""

## ê²°ì¸¡ì¹˜ ì œê±°
superhost_df = des_over[['Airbnb_ListingID','isSuperhost', 'Host_ResponseRate', 'Host_ResponseTime','HostLanguages_Verbose']]
superhost_df['Host_ResponseRate'].fillna("", inplace=True)
superhost_df['Host_ResponseTime'].fillna("", inplace=True)
superhost_df['HostLanguages_Verbose'].fillna("", inplace=True)
superhost_df

"""# 8.í¸ì˜ì„± ì •ë¦¬"""

checkin_df = des_over[['Airbnb_ListingID', 'amenities_SelfCheckIn', 'CheckIn_Start', 'CheckOut_End']]
# ê²°ì¸¡ì¹˜ ì±„ìš°ê¸°
checkin_df['amenities_SelfCheckIn'].fillna("", inplace=True)
checkin_df['CheckIn_Start'].fillna("", inplace=True)
checkin_df['CheckOut_End'].fillna("", inplace=True)

"""# 7. ìˆ™ì†Œ ë¦¬ë·° ì •ë¦¬"""

import pandas as pd
import re

pd.set_option('display.max_colwidth', 100)

def clean_text(text):
    # 1. í•œê¸€, ìˆ«ì, ê³µë°±, ë¬¸ì¥ë¶€í˜¸(.,?!ë§Œ ë‚¨ê¸°ê¸°)
    text = re.sub(r'[^ê°€-í£0-9\s\.\,\?\!]', ' ', str(text))

    # 2. ì—¬ëŸ¬ ê³µë°± â†’ í•˜ë‚˜ì˜ ê³µë°±ìœ¼ë¡œ ì¤„ì´ê¸°
    text = re.sub(r'\s{2,}', ' ', text)

    # 3. ì¢Œìš° ê³µë°± ì œê±°
    return text.strip()

# âœ… ê²°ì¸¡ì¹˜ ì œê±°
review_df = review[['Airbnb_ListingID', 'ReviewLanguage', 'ReviewComments', 'Rating']]
review_df = review_df[review_df['ReviewLanguage'] == 'ko'].dropna(subset=['ReviewComments', 'Rating'])
review_df['ReviewComments'] = review_df['ReviewComments'].apply(clean_text)

# âœ… ë¦¬ë·° ë³‘í•©
grouped_comments = review_df.groupby('Airbnb_ListingID')['ReviewComments'].apply(lambda x: ' '.join(x)).reset_index()

# âœ… í‰ì  í‰ê· 
grouped_rating = review_df.groupby('Airbnb_ListingID')['Rating'].mean().reset_index()

# âœ… ë¦¬ë·° ê°œìˆ˜
grouped_comments_counts = review_df.groupby('Airbnb_ListingID')['Rating'].size().reset_index()
grouped_comments_counts.columns = ['Airbnb_ListingID', 'ReviewCounts']

# âœ… ê²°í•©
review_summary_input = grouped_comments.merge(grouped_rating, on='Airbnb_ListingID') \
                                       .merge(grouped_comments_counts, on='Airbnb_ListingID')

# âœ… ë¦¬ë·° ê¸¸ì´ í•„í„°
review_summary_input['Review_Length'] = review_summary_input['ReviewComments'].apply(lambda x: len(x))
review_summary_input = review_summary_input[review_summary_input['Review_Length'] > 0]

def generate_better_summary(text, max_len=100):
    if pd.isna(text) or not isinstance(text, str) or len(text.strip()) == 0:
        return ""

    # ë¬¸ì¥ êµ¬ë¶„ìë¡œ ìë¥´ê¸° (.!? í¬í•¨)
    sentences = re.split(r'(?<=[\.\!\?])\s+', text.strip())
    summary = ""

    # ë¬¸ì¥ì´ 1ê°œ ì´ìƒ ìˆì„ ê²½ìš°
    if len(sentences) >= 2:
        summary = sentences[0]
        # ë¬¸ì¥ì´ ë„ˆë¬´ ì§§ìœ¼ë©´ ë‘ ë²ˆì§¸ ë¬¸ì¥ê¹Œì§€ í¬í•¨
        if len(summary) < 30:
            summary += " " + sentences[1]
    elif len(sentences) == 1:
        summary = sentences[0]
    else:
        return text[:max_len] + '...'

    # ë„ˆë¬´ ê¸¸ë©´ ìë¥´ê¸°
    return summary if len(summary) <= max_len else summary[:max_len].strip() + '...'
review_summary_input['ReviewSummary'] = review_summary_input['ReviewComments'].apply(generate_better_summary)

review_summary_input

"""# 8. ì¢…í•©"""

final_df = title_df \
    .merge(location_df, on='Airbnb_ListingID', how='left') \
    .merge(infor_df, on='Airbnb_ListingID', how='left') \
    .merge(amenity_df, on='Airbnb_ListingID', how='left') \
    .merge(type_df, on='Airbnb_ListingID', how='left') \
    .merge(superhost_df, on='Airbnb_ListingID', how='left') \
    .merge(checkin_df, on='Airbnb_ListingID', how='left') \
    .merge(review_summary_input, on='Airbnb_ListingID', how='inner')

final_df_all = cal_pri.merge(
    final_df,
    on='Airbnb_ListingID',
    how='left'
)

## ë¦¬ë·° ìš”ì•½ Nanì˜ ê²½ìš° ê·¸ëƒ¥ ë¦¬ë·°ë¡œ ì‚¬ìš©
final_df_all['ReviewSummary'] = final_df_all['ReviewSummary'].fillna(final_df_all['ReviewComments'])

## ëª¨ë“  ê²°ì¸¡ì¹˜ê°€ Hotelì˜ ê²½ìš°ë¼ì„œ Hotelë¡œ ëŒ€ì²´
final_df_all['RoomType_Clean'] = final_df_all['RoomType_Clean'].fillna('Hotel')

## ì´ë¦„, ë¦¬ë·°ê°€ ì—†ëŠ” ê²½ìš° ì œê±°
final_df_all = final_df_all.dropna(subset=['Title', 'ReviewComments'])

## ë¦¬ë·° ìš”ì•½ Nanì˜ ê²½ìš° ê·¸ëƒ¥ ë¦¬ë·°ë¡œ ì‚¬ìš©
final_df['ReviewSummary'] = final_df['ReviewSummary'].fillna(final_df['ReviewComments'])

## ëª¨ë“  ê²°ì¸¡ì¹˜ê°€ Hotelì˜ ê²½ìš°ë¼ì„œ Hotelë¡œ ëŒ€ì²´
final_df['RoomType_Clean'] = final_df['RoomType_Clean'].fillna('Hotel')

## ì´ë¦„, ë¦¬ë·°ê°€ ì—†ëŠ” ê²½ìš° ì œê±°
final_df = final_df.dropna(subset=['Title', 'ReviewComments'])

# cal_priì˜ ì»¬ëŸ¼ ë¦¬ìŠ¤íŠ¸ ì¶”ì¶œ
columns_to_keep = cal_pri.columns.tolist()

# final_df_allì—ì„œ í•´ë‹¹ ì»¬ëŸ¼ë§Œ ì¶”ì¶œ
final_price_df = final_df_all[columns_to_keep]

print("cal_pri shape:", cal_pri.shape)
print("final_df shape:", final_df.shape)
print("final_df_all shape:", final_df_all.shape)
print("final_price_df shape:", final_price_df.shape)

print(final_df.isnull().sum().to_string())

final_df[final_df.Airbnb_ListingID == 48689803]

print(final_price_df .isnull().sum().to_string())

final_price_df .head()

final_df.to_csv('/content/drive/MyDrive/dataset/final(0502).csv', index=False)

print(final_df.isnull().sum().to_string())

final_price_df.to_csv('/content/drive/MyDrive/dataset/final_price(0502).csv', index=False)

print(final_price_df.isnull().sum().to_string())

